<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="Linear Regression with Ordinary Least Squares, the basics">
        <meta name="author" content="m.zaradzki">

        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.bundle.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/1.0.1/simple_statistics.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.0/d3.min.js"></script>

        <!--<link rel="stylesheet" type="text/css" href="shared/shiny.css"/>
        
        <link rel="stylesheet" href="shared/slider/css/jquery.slider.min.css">
        
        <script src="shared/slider/js/jquery.slider.min.js" type="text/javascript"></script>-->
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.2.0/cosmo/bootstrap.min.css">
        <!--<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">-->
        <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>-->

        <script>
            var gaussian = function() {
                // Box Muller method
                var u = 1 - Math.random(); // Subtraction to flip [0, 1) to (0, 1].
                var v = 1 - Math.random();
                var g = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
                return g;
            }
            var intercept = -6;
            var beta = 3;
            var nbobs = 25;
            var errstd = .75;
            var Xs = [];
            for (i=0; i<nbobs; i++) {
                var x = gaussian();
                Xs.push(x);
            }
            var simAndReg = function() {
                var M = [];
                for (i=0; i<nbobs; i++) {
                    var y = intercept + beta*Xs[i] + errstd*gaussian();
                    M.push([Xs[i], y]);
                }
                var regcoeff = ss.linearRegression(M);
                var regfun = ss.linearRegressionLine(regcoeff);
                return {XY:M, regcoeff:regcoeff, regfun:regfun};
            }
            var SAR0 = simAndReg();
        </script>
    
    </head>
 
    <body>
    
        <div class="container">
        <div class="row"><div class="col-md-10 col-md-offset-1">
        
            <div class="page-header">
                <h1>Linear Regression : the basics</h1>
                <h1><small>M.ZARADZKI - 2014-2015</small></h1>
            </div>

            <div class="panel panel-danger">
                <div class="panel-heading"><b>NOTE</b></div>
                <div class="panel-body">
                    The R Shiny server is currently being replaced, in the meantime the demos cannot run
                </div>
            </div>
        
            <div class="panel panel-success">
                <div class="panel-heading">Purpose of this demo</div>
                <div class="panel-body">
                    Statistics is great but it is not magic. It cannot turn random data into certain knowledge.<br>
                    Good statistics is about getting a good sense of the bounds of achievable knowledge.<br>
                    The estimated parameters of a Linear Regression are random variables and the values returned by most software (e.g. LINEST in Excel) are the mean values of these variables.<br>
                    The following experiment demonstrates the estimation of the simplest of all Linear Regression model and repeats it several times (each time with a different random simulation but the same model) to illustrate the uncertainty about the Linear Regression coefficients.
                </div>
            </div>
            
            <div class="panel panel-info">
                <div class="panel-heading">Key notions to remember</div>
                <div class="panel-body">
                    <span class="label label-success">Least Square</span>
                    <span class="label label-success">Linear Regression</span>
                    <span class="label label-success">Intercept</span>
                    <span class="label label-success">Beta</span>
                    <span class="label label-success">R2 (squared)</span>
                    <span class="label label-success">Estimate uncertainty</span>
                </div>
            </div>
            
            <div class="panel panel-info">
                <div class="panel-heading">Experiment setup</div>
                <div class="panel-body">
                    
                    <div class="row">
                        <div class="col-md-3">
                            <label>Number of observations:</label><br /> 
                            <input type="number" name="nbobs" class="form-control" value="25" min="5" max="1000" />
                        </div>
                    </div>
                
                    <div class="row">
                        <div class="col-md-3">
                            <label>Model Intercept:</label><br />
                            <!--<input type="number" name="intercept" value="-5" />-->
                            <input type="text" name="intercept" class="form-control" value="-6"/>
                        </div>
                    </div>
                
                    <div class="row">
                        <div class="col-md-3">
                            <label>Model Coefficient:</label><br /> 
                            <input type="text" name="coefficient" class="form-control" value="3" />
                        </div>
                    </div>
                
                    <div class="row">
                        <div class="col-md-3">
                            <label>Error Standard Deviation:</label><br /> 
                            <input type="number" name="stdeviation" class="form-control" value="3" min="0" max="10" />
                        </div>
                    </div>
                    
                </div>
            </div>
         
            <div class="panel panel-info">
                <div class="panel-heading">Linear regression output</div>
                <div class="panel-body">
                    <pre id="summary" class="shiny-text-output"></pre>
                </div>
            </div>
            
            <div class="panel panel-info">
                <div class="panel-heading">Observed values against fitted values</div>
                <div class="panel-body">
                    <!--<div id="plotFit" class="shiny-plot-output" style="width:100%; height:400px"></div>-->
                    <canvas id="plotFit"></canvas>
                </div>
                <div class="panel-footer">No specific pattern in the errors</div>
            </div>
            
            <!--<div class="panel panel-info">
                <div class="panel-heading">Histogram of the error term</div>
                <div class="panel-body">
                    <div id="plotError" class="shiny-plot-output" style="width:100%; height:400px"></div>
                </div>
            </div>-->
            
            <div class="panel panel-info">
                <div class="panel-heading">Summary of (100x) repeated OLS experiments</div>
                <div class="panel-body">
                    <!--<div id="plotBoxes" class="shiny-plot-output" style="height:800px"></div>-->
                    <canvas id="plotBoxes"></canvas>
                </div>
            </div>
            
            <div class="panel panel-info">
                <div class="panel-heading">Infered distribution (*) of intercept and beta</div>
                <div class="panel-body">
                    <div id="plotNorms" class="shiny-plot-output" style="width:100%; height:400px"></div>
                </div>
                <div class="panel-footer">* An approximative distribution only!</div>
            </div>
            
            <!--<div class="panel panel-info">
                <div class="panel-heading">Infered distribution (*) of beta</div>
                <div class="panel-body">
                    <div id="plotNormBeta" class="shiny-plot-output" style="width:100%; height:400px"></div>
                </div>
                <div class="panel-footer">* an approximative distribution only</div>
            </div>-->
            
            <div class="panel panel-info">
                <div class="panel-heading">Forecast simulation setup</div>
                <div class="panel-body">
                    <!--<label>Test X-valueNumber of observations:</label><br /> 
                    <input type="number" name="newX" class="shiny-slider-input form-control" value="25" min="5" max="1000" />-->
                    <label class="control-label" for="newX">Test X-value:</label>
                    <input id="newX" type="slider" name="newX" value="10" class="jslider" data-from="-20" data-to="20" data-step="1" data-skin="plastic" data-round="FALSE" data-locale="us" data-format="#,##0.#####" data-smooth="FALSE"/>
                </div>
            </div>
            
            <div class="panel panel-info">
                <div class="panel-heading">Histogram of simulated forecasts</div>
                <div class="panel-body">
                    <!--<div class="shiny-plot-output" style="width:100%; height:400px"></div>-->
                    <canvas id="plotHistForecast"></canvas>
                </div>
                <div class="panel-footer">This is the so-called bootstraping method</div>
            </div>
        
        </div></div>
        </div>

        <script>
            var ctx3 = document.getElementById("plotFit").getContext("2d");
            var datapoints3 = [];
            for (var i3=0; i3<SAR0.XY.length; i3++) {
                datapoints3.push( {x:SAR0.XY[i3][1], y:SAR0.regfun(SAR0.XY[i3][0]), r:5} );
            }
            var myChart3 = new Chart(ctx3, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'error',
                        data: datapoints3,
                        backgroundColor: "#FF6384",
                        hoverBackgroundColor: "#FF6384",
                    }],
                },
            });
        </script>
        <script>
            var ctx4 = document.getElementById("plotBoxes").getContext("2d");
            var datapoints4 = [];
            for (var i4=0; i4<100; i4++) {
                var sar = simAndReg();
                datapoints4.push( {x:sar.regcoeff.m, y:sar.regcoeff.b, r:3} );
            }
            var myChart4 = new Chart(ctx4, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'coefficients',
                        data: datapoints4,
                        backgroundColor: "#FF6384",
                        hoverBackgroundColor: "#FF6384",
                    }],
                },
            });
        </script>
        <script>
            var newX = 10;
            var arr5 = [];
            for (var i5=0; i5<100; i5++) {
                var sar = simAndReg();
                arr5.push( sar.regfun(newX) );
            }
            var bins5 = d3.histogram().thresholds(9)(arr5); //.domain([0,1])
            var labels5 = [];
            var data5 = [];
            for (var i5=0; i5<bins5.length; i5++) {
                labels5.push( 0.5*(bins5[i5].x0+bins5[i5].x1) );
                data5.push( bins5[i5].length/arr5.length );
            }
            var ctx5 = document.getElementById("plotHistForecast").getContext("2d");
            var myChart5 = new Chart(ctx5, {
                type: 'bar',
                data: {
                    labels: labels5,
                    datasets: [{
                        label: 'forecasts',
                        data: data5,
                        backgroundColor: "#FF6384",
                        hoverBackgroundColor: "#FF6384",
                    }],
                },
            });
        </script>
    </body>

</html>